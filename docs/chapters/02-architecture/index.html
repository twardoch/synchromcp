
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../01-introduction/">
      
      
        <link rel="next" href="../05-filesystem/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="zensical-0.0.10">
    
    
      
        <title>Chapter 2: MCP Architecture and Protocol Specification - synchromcp</title>
      
    
    
      
        
      
      <link rel="stylesheet" href="../../assets/stylesheets/modern/main.eafc6f7f.min.css">
      
      
  
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
  
  <style>:root{}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,500,500i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,t)=>(e<<5)-e+t.charCodeAt(0)),0),__md_get=(e,t=localStorage,a=__md_scope)=>JSON.parse(t.getItem(a.pathname+"."+e)),__md_set=(e,t,a=localStorage,_=__md_scope)=>{try{a.setItem(_.pathname+"."+e,JSON.stringify(t))}catch(e){}},document.documentElement.setAttribute("data-platform",navigator.platform)</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chapter-2-mcp-architecture-and-protocol-specification" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="synchromcp" class="md-header__button md-logo" aria-label="synchromcp" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-book-open" viewBox="0 0 24 24"><path d="M12 7v14M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-menu" viewBox="0 0 24 24"><path d="M4 5h16M4 12h16M4 19h16"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            synchromcp
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 2: MCP Architecture and Protocol Specification
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-search" viewBox="0 0 24 24"><path d="m21 21-4.34-4.34"/><circle cx="11" cy="11" r="8"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog" aria-label="Search">
  <button type="button" class="md-search__button">
    Search
  </button>
</div>
      
    
    <div class="md-header__source">
      
    </div>
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="synchromcp" class="md-nav__button md-logo" aria-label="synchromcp" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-book-open" viewBox="0 0 24 24"><path d="M12 7v14M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"/></svg>

    </a>
    synchromcp
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Complete MCP Handbook Documentation
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Complete MCP Handbook: A Guide to Model Context Protocol
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../book-outline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Complete MCP Handbook: A 25-Chapter Guide to Model Context Protocol
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Chapters
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Chapters
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 1: Introduction to Model Context Protocol
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Chapter 2: MCP Architecture and Protocol Specification
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 2: MCP Architecture and Protocol Specification
  

    
  </span>
  
  

      </a>
      
        


<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-client-host-server-topology-deep-dive" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Client-Host-Server Topology Deep Dive
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Client-Host-Server Topology Deep Dive">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-component-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1 Component Architecture
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.1 Component Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#client-layer-responsibilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Client Layer Responsibilities
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#host-layer-responsibilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Host Layer Responsibilities
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server-layer-responsibilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Server Layer Responsibilities
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-json-rpc-message-format-and-protocol-flows" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. JSON-RPC Message Format and Protocol Flows
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. JSON-RPC Message Format and Protocol Flows">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-message-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1 Message Structure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.1 Message Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base-request-message" class="md-nav__link">
    <span class="md-ellipsis">
      
        Base Request Message
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#base-response-message" class="md-nav__link">
    <span class="md-ellipsis">
      
        Base Response Message
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-response-message" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error Response Message
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-core-protocol-methods" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2 Core Protocol Methods
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2 Core Protocol Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#server-initialization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Server Initialization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tool-listing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tool Listing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tool-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tool Execution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-access" class="md-nav__link">
    <span class="md-ellipsis">
      
        Resource Access
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-message-flow-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3 Message Flow Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.3 Message Flow Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#standard-tool-execution-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Standard Tool Execution Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#human-in-the-loop-approval-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Human-in-the-Loop Approval Flow
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-capability-negotiation-and-session-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Capability Negotiation and Session Management
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Capability Negotiation and Session Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-server-capabilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1 Server Capabilities
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.1 Server Capabilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tool-capabilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tool Capabilities
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-capabilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Resource Capabilities
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prompt-capabilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prompt Capabilities
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-session-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2 Session Lifecycle
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.2 Session Lifecycle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#session-initialization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Session Initialization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initialized-confirmation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Initialized Confirmation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-transport-agnostic-capabilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.3 Transport-Agnostic Capabilities
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-transport-layer-implementations-and-trade-offs" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Transport Layer Implementations and Trade-offs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Transport Layer Implementations and Trade-offs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-standard-inputoutput-stdio-transport" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1 Standard Input/Output (stdio) Transport
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.1 Standard Input&#x2f;Output (stdio) Transport">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Details
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advantages-and-limitations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Advantages and Limitations
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-server-sent-events-sse-transport" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.2 Server-Sent Events (SSE) Transport
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.2 Server-Sent Events (SSE) Transport">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architecture_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration Examples
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-httpstreaming-transport" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3 HTTP/Streaming Transport
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.3 HTTP&#x2f;Streaming Transport">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#server-sent-events-with-bidirectional-communication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Server-Sent Events with Bidirectional Communication
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-security-model-permissions-auditing-and-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Security Model: Permissions, Auditing, and Isolation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Security Model: Permissions, Auditing, and Isolation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-permission-system-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1 Permission System Architecture
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.1 Permission System Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#capability-based-access-control" class="md-nav__link">
    <span class="md-ellipsis">
      
        Capability-Based Access Control
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#permission-categories" class="md-nav__link">
    <span class="md-ellipsis">
      
        Permission Categories
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-human-in-the-loop-approval-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2 Human-in-the-Loop Approval System
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.2 Human-in-the-Loop Approval System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#approval-workflow-matrix" class="md-nav__link">
    <span class="md-ellipsis">
      
        Approval Workflow Matrix
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#approval-state-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Approval State Management
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-auditing-and-logging" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.3 Auditing and Logging
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.3 Auditing and Logging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#comprehensive-audit-trail" class="md-nav__link">
    <span class="md-ellipsis">
      
        Comprehensive Audit Trail
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#log-analysis-and-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      
        Log Analysis and Monitoring
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-advanced-protocol-features" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Advanced Protocol Features
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Advanced Protocol Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-streaming-and-chunked-responses" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.1 Streaming and Chunked Responses
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.1 Streaming and Chunked Responses">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#large-response-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Large Response Handling
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-resource-subscriptions" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.2 Resource Subscriptions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.2 Resource Subscriptions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#change-notification-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Change Notification System
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-tool-composition-and-pipelining" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.3 Tool Composition and Pipelining
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.3 Tool Composition and Pipelining">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#multi-tool-workflows" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi-Tool Workflows
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-error-handling-and-recovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Error Handling and Recovery
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Error Handling and Recovery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-standardized-error-codes" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.1 Standardized Error Codes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-recovery-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.2 Recovery Strategies
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7.2 Recovery Strategies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connection-resilience" class="md-nav__link">
    <span class="md-ellipsis">
      
        Connection Resilience
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#graceful-degradation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Graceful Degradation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-performance-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Performance Optimization
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. Performance Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-message-compression-and-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.1 Message Compression and Optimization
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8.1 Message Compression and Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#efficient-message-formats" class="md-nav__link">
    <span class="md-ellipsis">
      
        Efficient Message Formats
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-concurrent-operations" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.2 Concurrent Operations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8.2 Concurrent Operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parallel-tool-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parallel Tool Execution
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-protocol-extensions-and-customization" class="md-nav__link">
    <span class="md-ellipsis">
      
        9. Protocol Extensions and Customization
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9. Protocol Extensions and Customization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91-custom-tool-categories" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.1 Custom Tool Categories
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.1 Custom Tool Categories">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#extending-the-protocol" class="md-nav__link">
    <span class="md-ellipsis">
      
        Extending the Protocol
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92-cross-protocol-compatibility" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.2 Cross-Protocol Compatibility
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.2 Cross-Protocol Compatibility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adapter-pattern-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Adapter Pattern Implementation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-best-practices-and-implementation-guidelines" class="md-nav__link">
    <span class="md-ellipsis">
      
        10. Best Practices and Implementation Guidelines
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="10. Best Practices and Implementation Guidelines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#101-server-development-guidelines" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.1 Server Development Guidelines
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="10.1 Server Development Guidelines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#security-implementation-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security Implementation Checklist
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-guidelines" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance Guidelines
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#102-client-implementation-guidelines" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.2 Client Implementation Guidelines
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="10.2 Client Implementation Guidelines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#robust-error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Robust Error Handling
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-testing-and-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        11. Testing and Validation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11. Testing and Validation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#111-protocol-compliance-testing" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.1 Protocol Compliance Testing
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.1 Protocol Compliance Testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automated-test-suite" class="md-nav__link">
    <span class="md-ellipsis">
      
        Automated Test Suite
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      
        12. Conclusion
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12. Conclusion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#design-strengths" class="md-nav__link">
    <span class="md-ellipsis">
      
        Design Strengths
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Considerations
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-filesystem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 5: Filesystem Server - Local Development Foundation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../13-search-research/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 13: Search and Research Servers: Information Discovery and Knowledge Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../24-server-development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 24: MCP Server Development Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../25-production-ops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chapter 25: Production Operations and Management
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-client-host-server-topology-deep-dive" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Client-Host-Server Topology Deep Dive
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Client-Host-Server Topology Deep Dive">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-component-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1 Component Architecture
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.1 Component Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#client-layer-responsibilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Client Layer Responsibilities
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#host-layer-responsibilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Host Layer Responsibilities
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server-layer-responsibilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Server Layer Responsibilities
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-json-rpc-message-format-and-protocol-flows" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. JSON-RPC Message Format and Protocol Flows
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. JSON-RPC Message Format and Protocol Flows">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-message-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1 Message Structure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.1 Message Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base-request-message" class="md-nav__link">
    <span class="md-ellipsis">
      
        Base Request Message
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#base-response-message" class="md-nav__link">
    <span class="md-ellipsis">
      
        Base Response Message
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-response-message" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error Response Message
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-core-protocol-methods" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2 Core Protocol Methods
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2 Core Protocol Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#server-initialization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Server Initialization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tool-listing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tool Listing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tool-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tool Execution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-access" class="md-nav__link">
    <span class="md-ellipsis">
      
        Resource Access
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-message-flow-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3 Message Flow Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.3 Message Flow Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#standard-tool-execution-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Standard Tool Execution Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#human-in-the-loop-approval-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Human-in-the-Loop Approval Flow
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-capability-negotiation-and-session-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Capability Negotiation and Session Management
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Capability Negotiation and Session Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-server-capabilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1 Server Capabilities
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.1 Server Capabilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tool-capabilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tool Capabilities
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-capabilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Resource Capabilities
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prompt-capabilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prompt Capabilities
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-session-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2 Session Lifecycle
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3.2 Session Lifecycle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#session-initialization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Session Initialization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initialized-confirmation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Initialized Confirmation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-transport-agnostic-capabilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.3 Transport-Agnostic Capabilities
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-transport-layer-implementations-and-trade-offs" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Transport Layer Implementations and Trade-offs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Transport Layer Implementations and Trade-offs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-standard-inputoutput-stdio-transport" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1 Standard Input/Output (stdio) Transport
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.1 Standard Input&#x2f;Output (stdio) Transport">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Details
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advantages-and-limitations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Advantages and Limitations
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-server-sent-events-sse-transport" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.2 Server-Sent Events (SSE) Transport
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.2 Server-Sent Events (SSE) Transport">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#architecture_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration Examples
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-httpstreaming-transport" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.3 HTTP/Streaming Transport
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.3 HTTP&#x2f;Streaming Transport">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#server-sent-events-with-bidirectional-communication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Server-Sent Events with Bidirectional Communication
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-security-model-permissions-auditing-and-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Security Model: Permissions, Auditing, and Isolation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Security Model: Permissions, Auditing, and Isolation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-permission-system-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1 Permission System Architecture
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.1 Permission System Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#capability-based-access-control" class="md-nav__link">
    <span class="md-ellipsis">
      
        Capability-Based Access Control
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#permission-categories" class="md-nav__link">
    <span class="md-ellipsis">
      
        Permission Categories
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-human-in-the-loop-approval-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2 Human-in-the-Loop Approval System
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.2 Human-in-the-Loop Approval System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#approval-workflow-matrix" class="md-nav__link">
    <span class="md-ellipsis">
      
        Approval Workflow Matrix
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#approval-state-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Approval State Management
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-auditing-and-logging" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.3 Auditing and Logging
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5.3 Auditing and Logging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#comprehensive-audit-trail" class="md-nav__link">
    <span class="md-ellipsis">
      
        Comprehensive Audit Trail
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#log-analysis-and-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      
        Log Analysis and Monitoring
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-advanced-protocol-features" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Advanced Protocol Features
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Advanced Protocol Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-streaming-and-chunked-responses" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.1 Streaming and Chunked Responses
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.1 Streaming and Chunked Responses">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#large-response-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Large Response Handling
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-resource-subscriptions" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.2 Resource Subscriptions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.2 Resource Subscriptions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#change-notification-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Change Notification System
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-tool-composition-and-pipelining" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.3 Tool Composition and Pipelining
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6.3 Tool Composition and Pipelining">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#multi-tool-workflows" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi-Tool Workflows
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-error-handling-and-recovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Error Handling and Recovery
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Error Handling and Recovery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-standardized-error-codes" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.1 Standardized Error Codes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-recovery-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.2 Recovery Strategies
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7.2 Recovery Strategies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connection-resilience" class="md-nav__link">
    <span class="md-ellipsis">
      
        Connection Resilience
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#graceful-degradation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Graceful Degradation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-performance-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Performance Optimization
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. Performance Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-message-compression-and-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.1 Message Compression and Optimization
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8.1 Message Compression and Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#efficient-message-formats" class="md-nav__link">
    <span class="md-ellipsis">
      
        Efficient Message Formats
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-concurrent-operations" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.2 Concurrent Operations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8.2 Concurrent Operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parallel-tool-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parallel Tool Execution
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-protocol-extensions-and-customization" class="md-nav__link">
    <span class="md-ellipsis">
      
        9. Protocol Extensions and Customization
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9. Protocol Extensions and Customization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91-custom-tool-categories" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.1 Custom Tool Categories
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.1 Custom Tool Categories">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#extending-the-protocol" class="md-nav__link">
    <span class="md-ellipsis">
      
        Extending the Protocol
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92-cross-protocol-compatibility" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.2 Cross-Protocol Compatibility
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9.2 Cross-Protocol Compatibility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adapter-pattern-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Adapter Pattern Implementation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-best-practices-and-implementation-guidelines" class="md-nav__link">
    <span class="md-ellipsis">
      
        10. Best Practices and Implementation Guidelines
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="10. Best Practices and Implementation Guidelines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#101-server-development-guidelines" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.1 Server Development Guidelines
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="10.1 Server Development Guidelines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#security-implementation-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security Implementation Checklist
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-guidelines" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance Guidelines
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#102-client-implementation-guidelines" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.2 Client Implementation Guidelines
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="10.2 Client Implementation Guidelines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#robust-error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Robust Error Handling
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-testing-and-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        11. Testing and Validation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11. Testing and Validation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#111-protocol-compliance-testing" class="md-nav__link">
    <span class="md-ellipsis">
      
        11.1 Protocol Compliance Testing
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11.1 Protocol Compliance Testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automated-test-suite" class="md-nav__link">
    <span class="md-ellipsis">
      
        Automated Test Suite
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      
        12. Conclusion
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12. Conclusion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#design-strengths" class="md-nav__link">
    <span class="md-ellipsis">
      
        Design Strengths
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Considerations
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  

<h1 id="chapter-2-mcp-architecture-and-protocol-specification">Chapter 2: MCP Architecture and Protocol Specification<a class="headerlink" href="#chapter-2-mcp-architecture-and-protocol-specification" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>This chapter provides a comprehensive technical examination of the Model Context Protocol architecture, message flows, and specification details. Understanding the underlying architecture is essential for building robust, secure, and performant MCP servers and clients. We'll explore the client-host-server topology, JSON-RPC message format, transport layer implementations, and security mechanisms that make MCP a production-ready protocol.</p>
<hr />
<h2 id="1-client-host-server-topology-deep-dive">1. Client-Host-Server Topology Deep Dive<a class="headerlink" href="#1-client-host-server-topology-deep-dive" title="Permanent link">&para;</a></h2>
<h3 id="11-component-architecture">1.1 Component Architecture<a class="headerlink" href="#11-component-architecture" title="Permanent link">&para;</a></h3>
<p>MCP implements a three-layer architecture that separates concerns for security, flexibility, and scalability:</p>
<pre class="mermaid"><code>graph TB
    subgraph "Client Layer"
        A[Claude Desktop]
        B[Cursor IDE]
        C[VS Code]
        D[Custom Application]
    end

    subgraph "Host/Transport Layer"
        E[MCP Host Process]
        F[Permission Manager]
        G[Transport Handler]
        H[Session Manager]
    end

    subgraph "Server Layer"
        I[Filesystem Server]
        J[Database Server]
        K[Git Server]
        L[Custom Server]
    end

    A --&gt; E
    B --&gt; E
    C --&gt; E
    D --&gt; E

    E --&gt; F
    E --&gt; G
    E --&gt; H

    G --&gt; I
    G --&gt; J
    G --&gt; K
    G --&gt; L</code></pre>
<h4 id="client-layer-responsibilities">Client Layer Responsibilities<a class="headerlink" href="#client-layer-responsibilities" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>User Interface</strong>: Present AI capabilities to end users</li>
<li><strong>Intent Translation</strong>: Convert user requests to MCP protocol messages</li>
<li><strong>Response Rendering</strong>: Format server responses for user consumption</li>
<li><strong>Session Management</strong>: Maintain conversation context and state</li>
</ul>
<h4 id="host-layer-responsibilities">Host Layer Responsibilities<a class="headerlink" href="#host-layer-responsibilities" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Connection Lifecycle</strong>: Initialize, maintain, and terminate server connections</li>
<li><strong>Permission Enforcement</strong>: Apply security policies and approval workflows</li>
<li><strong>Transport Management</strong>: Handle stdio, SSE, and HTTP transport protocols</li>
<li><strong>Resource Coordination</strong>: Manage multiple concurrent server connections</li>
</ul>
<h4 id="server-layer-responsibilities">Server Layer Responsibilities<a class="headerlink" href="#server-layer-responsibilities" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Capability Exposure</strong>: Define and implement tools, resources, and prompts</li>
<li><strong>Protocol Compliance</strong>: Handle MCP message format and patterns</li>
<li><strong>State Management</strong>: Maintain server-side state and data connections</li>
<li><strong>Security Enforcement</strong>: Implement sandboxing and access controls</li>
</ul>
<hr />
<h2 id="2-json-rpc-message-format-and-protocol-flows">2. JSON-RPC Message Format and Protocol Flows<a class="headerlink" href="#2-json-rpc-message-format-and-protocol-flows" title="Permanent link">&para;</a></h2>
<h3 id="21-message-structure">2.1 Message Structure<a class="headerlink" href="#21-message-structure" title="Permanent link">&para;</a></h3>
<p>MCP is built on JSON-RPC 2.0 with specific extensions for AI model integration:</p>
<h4 id="base-request-message">Base Request Message<a class="headerlink" href="#base-request-message" title="Permanent link">&para;</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">  </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string | integer | null&quot;</span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">  </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;method_name&quot;</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">  </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="c1">// Method-specific parameters</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="base-response-message">Base Response Message<a class="headerlink" href="#base-response-message" title="Permanent link">&para;</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="p">{</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">  </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string | integer | null&quot;</span><span class="p">,</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">  </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span><span class="c1">// Success response data</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="error-response-message">Error Response Message<a class="headerlink" href="#error-response-message" title="Permanent link">&para;</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="p">{</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">  </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string | integer | null&quot;</span><span class="p">,</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">  </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">    </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">-32000</span><span class="p">,</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">    </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Human approval required&quot;</span><span class="p">,</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">      </span><span class="nt">&quot;tool&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;write_file&quot;</span><span class="p">,</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">      </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/etc/hosts&quot;</span><span class="p">,</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">      </span><span class="nt">&quot;reason&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;System file modification requires confirmation&quot;</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="22-core-protocol-methods">2.2 Core Protocol Methods<a class="headerlink" href="#22-core-protocol-methods" title="Permanent link">&para;</a></h3>
<h4 id="server-initialization">Server Initialization<a class="headerlink" href="#server-initialization" title="Permanent link">&para;</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="p">{</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;initialize&quot;</span><span class="p">,</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">  </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="nt">&quot;protocolVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-06-18&quot;</span><span class="p">,</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span><span class="nt">&quot;capabilities&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">      </span><span class="nt">&quot;tools&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">      </span><span class="nt">&quot;resources&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">      </span><span class="nt">&quot;prompts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">    </span><span class="nt">&quot;clientInfo&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Claude Desktop&quot;</span><span class="p">,</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">      </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="tool-listing">Tool Listing<a class="headerlink" href="#tool-listing" title="Permanent link">&para;</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="p">{</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tools/list&quot;</span><span class="p">,</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">  </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="tool-execution">Tool Execution<a class="headerlink" href="#tool-execution" title="Permanent link">&para;</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="p">{</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">  </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tools/call&quot;</span><span class="p">,</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">  </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;write_file&quot;</span><span class="p">,</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">    </span><span class="nt">&quot;arguments&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">      </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;~/projects/example.txt&quot;</span><span class="p">,</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">      </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Hello, MCP!&quot;</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="resource-access">Resource Access<a class="headerlink" href="#resource-access" title="Permanent link">&para;</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="p">{</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">  </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;resources/read&quot;</span><span class="p">,</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">  </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">    </span><span class="nt">&quot;uri&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;file:///home/user/project/config.json&quot;</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="23-message-flow-patterns">2.3 Message Flow Patterns<a class="headerlink" href="#23-message-flow-patterns" title="Permanent link">&para;</a></h3>
<h4 id="standard-tool-execution-flow">Standard Tool Execution Flow<a class="headerlink" href="#standard-tool-execution-flow" title="Permanent link">&para;</a></h4>
<pre class="mermaid"><code>sequenceDiagram
    participant C as Client
    participant H as Host
    participant S as Server

    C-&gt;&gt;H tools/call request
    H-&gt;&gt;H Apply permission checks
    H-&gt;&gt;S Forward request
    S-&gt;&gt;S Execute tool logic
    S-&gt;&gt;H Return response
    H-&gt;&gt;H Apply response filtering
    H-&gt;&gt;C Return final response</code></pre>
<h4 id="human-in-the-loop-approval-flow">Human-in-the-Loop Approval Flow<a class="headerlink" href="#human-in-the-loop-approval-flow" title="Permanent link">&para;</a></h4>
<pre class="mermaid"><code>sequenceDiagram
    participant C as Client
    participant H as Host
    participant U as User
    participant S as Server

    C-&gt;&gt;H tools/call request (high risk)
    H-&gt;&gt;H Detect approval requirement
    C-&gt;&gt;U Request approval
    U-&gt;&gt;C Provide approval decision
    C-&gt;&gt;H Continue with approval
    H-&gt;&gt;S Execute approved request
    S-&gt;&gt;H Return result
    H-&gt;&gt;C Complete flow</code></pre>
<hr />
<h2 id="3-capability-negotiation-and-session-management">3. Capability Negotiation and Session Management<a class="headerlink" href="#3-capability-negotiation-and-session-management" title="Permanent link">&para;</a></h2>
<h3 id="31-server-capabilities">3.1 Server Capabilities<a class="headerlink" href="#31-server-capabilities" title="Permanent link">&para;</a></h3>
<h4 id="tool-capabilities">Tool Capabilities<a class="headerlink" href="#tool-capabilities" title="Permanent link">&para;</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="p">{</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">  </span><span class="nt">&quot;tools&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span><span class="nt">&quot;listChanged&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">    </span><span class="nt">&quot;experimentalFeatures&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">      </span><span class="nt">&quot;streamingResponses&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">      </span><span class="nt">&quot;batchOperations&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="resource-capabilities">Resource Capabilities<a class="headerlink" href="#resource-capabilities" title="Permanent link">&para;</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="p">{</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">  </span><span class="nt">&quot;resources&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">    </span><span class="nt">&quot;subscribe&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">    </span><span class="nt">&quot;listChanged&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="prompt-capabilities">Prompt Capabilities<a class="headerlink" href="#prompt-capabilities" title="Permanent link">&para;</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="p">{</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">  </span><span class="nt">&quot;prompts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">    </span><span class="nt">&quot;listChanged&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">    </span><span class="nt">&quot;arguments&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="32-session-lifecycle">3.2 Session Lifecycle<a class="headerlink" href="#32-session-lifecycle" title="Permanent link">&para;</a></h3>
<h4 id="session-initialization">Session Initialization<a class="headerlink" href="#session-initialization" title="Permanent link">&para;</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="p">{</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">  </span><span class="nt">&quot;initialize&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="nt">&quot;protocolVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-06-18&quot;</span><span class="p">,</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">    </span><span class="nt">&quot;capabilities&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">      </span><span class="nt">&quot;roots&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">        </span><span class="nt">&quot;listChanged&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">      </span><span class="nt">&quot;sampling&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">    </span><span class="nt">&quot;clientInfo&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Claude Desktop&quot;</span><span class="p">,</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">      </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="initialized-confirmation">Initialized Confirmation<a class="headerlink" href="#initialized-confirmation" title="Permanent link">&para;</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="p">{</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">  </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;notifications/initialized&quot;</span><span class="p">,</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">  </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="33-transport-agnostic-capabilities">3.3 Transport-Agnostic Capabilities<a class="headerlink" href="#33-transport-agnostic-capabilities" title="Permanent link">&para;</a></h3>
<p>MCP ensures consistent capability sets across different transport mechanisms:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="p">{</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">  </span><span class="nt">&quot;capabilityGuarantee&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">    </span><span class="nt">&quot;stdio&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;tools&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;resources&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;prompts&quot;</span><span class="p">],</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">    </span><span class="nt">&quot;sse&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;tools&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;resources&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;prompts&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;subscriptions&quot;</span><span class="p">],</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">    </span><span class="nt">&quot;http&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;tools&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;resources&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;prompts&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;streaming&quot;</span><span class="p">]</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="p">}</span>
</span></code></pre></div>
<hr />
<h2 id="4-transport-layer-implementations-and-trade-offs">4. Transport Layer Implementations and Trade-offs<a class="headerlink" href="#4-transport-layer-implementations-and-trade-offs" title="Permanent link">&para;</a></h2>
<h3 id="41-standard-inputoutput-stdio-transport">4.1 Standard Input/Output (stdio) Transport<a class="headerlink" href="#41-standard-inputoutput-stdio-transport" title="Permanent link">&para;</a></h3>
<h4 id="architecture">Architecture<a class="headerlink" href="#architecture" title="Permanent link">&para;</a></h4>
<pre class="mermaid"><code>graph LR
    A[Client Process] --&gt;|stdout| B[Host Process]
    B --&gt;|stdin| A

    B --&gt;|stdout| C[Server Process]
    C --&gt;|stdin| B</code></pre>
<h4 id="implementation-details">Implementation Details<a class="headerlink" href="#implementation-details" title="Permanent link">&para;</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1"># Simplified stdio transport implementation</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">StdioTransport</span><span class="p">:</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">StreamReader</span><span class="p">()</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">StreamWriter</span><span class="p">()</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Send JSON-RPC message over stdout&quot;&quot;&quot;</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>        <span class="n">json_message</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json_message</span><span class="p">)</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">receive_message</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Receive JSON-RPC message from stdin&quot;&quot;&quot;</span>
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>        <span class="n">line</span> <span class="o">=</span> <span class="k">await</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span></code></pre></div>
<h4 id="advantages-and-limitations">Advantages and Limitations<a class="headerlink" href="#advantages-and-limitations" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Advantages</th>
<th>Limitations</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Security</strong></td>
<td>No network exposure, inherits process permissions</td>
<td>Limited to local execution</td>
</tr>
<tr>
<td><strong>Performance</strong></td>
<td>Low latency, direct process communication</td>
<td>Single connection per server</td>
</tr>
<tr>
<td><strong>Scalability</strong></td>
<td>Simple deployment, minimal dependencies</td>
<td>Not ideal for distributed systems</td>
</tr>
<tr>
<td><strong>Debugging</strong></td>
<td>Easy to capture and analyze message flow</td>
<td>Limited monitoring capabilities</td>
</tr>
</tbody>
</table>
<h3 id="42-server-sent-events-sse-transport">4.2 Server-Sent Events (SSE) Transport<a class="headerlink" href="#42-server-sent-events-sse-transport" title="Permanent link">&para;</a></h3>
<h4 id="architecture_1">Architecture<a class="headerlink" href="#architecture_1" title="Permanent link">&para;</a></h4>
<pre class="mermaid"><code>graph TB
    A[Client HTTP Request] --&gt; B[Host SSE Endpoint]
    B --&gt;|SSE Stream| C[Persistent Connection]
    C --&gt;|JSON-RPC Messages| D[Server Processing]
    D --&gt;|Responses| C
    C --&gt;|SSE Events| A</code></pre>
<h4 id="implementation-pattern">Implementation Pattern<a class="headerlink" href="#implementation-pattern" title="Permanent link">&para;</a></h4>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1">// SSE Client Implementation</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="kd">class</span><span class="w"> </span><span class="nx">SSETransport</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">url</span><span class="p">;</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">eventSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">pendingRequests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Map</span><span class="p">();</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">connect</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">eventSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">EventSource</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">eventSource</span><span class="p">.</span><span class="nx">onmessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">pending</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">pendingRequests</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">pending</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="w">        </span><span class="nx">pending</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">pendingRequests</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">sendRequest</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span><span class="w"> </span><span class="nx">params</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">generateId</span><span class="p">();</span>
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">jsonrpc</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">method</span><span class="p">,</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>
</span><span id="__span-14-26"><a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">responsePromise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-27"><a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">pendingRequests</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-14-28"><a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-14-29"><a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a>
</span><span id="__span-14-30"><a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a><span class="w">    </span><span class="nx">fetch</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-31"><a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a><span class="w">      </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span><span id="__span-14-32"><a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a><span class="w">      </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-14-33"><a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a><span class="w">      </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span>
</span><span id="__span-14-34"><a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-14-35"><a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a>
</span><span id="__span-14-36"><a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">responsePromise</span><span class="p">;</span>
</span><span id="__span-14-37"><a id="__codelineno-14-37" name="__codelineno-14-37" href="#__codelineno-14-37"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-14-38"><a id="__codelineno-14-38" name="__codelineno-14-38" href="#__codelineno-14-38"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="configuration-examples">Configuration Examples<a class="headerlink" href="#configuration-examples" title="Permanent link">&para;</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="p">{</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">  </span><span class="nt">&quot;sse_transport&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">    </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;npx&quot;</span><span class="p">,</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">    </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;-y&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/server-postgres&quot;</span><span class="p">],</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">    </span><span class="nt">&quot;env&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">      </span><span class="nt">&quot;MCP_TRANSPORT&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sse&quot;</span><span class="p">,</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w">      </span><span class="nt">&quot;SSE_PORT&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;8080&quot;</span><span class="p">,</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w">      </span><span class="nt">&quot;CORS_ORIGIN&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http://localhost:3000&quot;</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="43-httpstreaming-transport">4.3 HTTP/Streaming Transport<a class="headerlink" href="#43-httpstreaming-transport" title="Permanent link">&para;</a></h3>
<h4 id="server-sent-events-with-bidirectional-communication">Server-Sent Events with Bidirectional Communication<a class="headerlink" href="#server-sent-events-with-bidirectional-communication" title="Permanent link">&para;</a></h4>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1">// HTTP/Streaming Server Implementation</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="kd">class</span><span class="w"> </span><span class="nx">HTTPStreamingTransport</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{})</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">options</span><span class="p">.</span><span class="nx">port</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">8080</span><span class="p">;</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">connections</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Set</span><span class="p">();</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">startServer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">express</span><span class="p">();</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="w">    </span><span class="nx">server</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/events&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="w">      </span><span class="c1">// SSE endpoint for server-&gt;client communication</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="w">      </span><span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mf">200</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="w">        </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;text/event-stream&#39;</span><span class="p">,</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="w">        </span><span class="s1">&#39;Cache-Control&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;no-cache&#39;</span><span class="p">,</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="w">        </span><span class="s1">&#39;Connection&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;keep-alive&#39;</span>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="w">      </span><span class="p">});</span>
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">connections</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a>
</span><span id="__span-16-21"><a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a><span class="w">      </span><span class="nx">req</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-22"><a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">connections</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
</span><span id="__span-16-23"><a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a><span class="w">      </span><span class="p">});</span>
</span><span id="__span-16-24"><a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-16-25"><a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a>
</span><span id="__span-16-26"><a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a><span class="w">    </span><span class="nx">server</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/request&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">(),</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-27"><a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a><span class="w">      </span><span class="c1">// Handle client-&gt;server requests</span>
</span><span id="__span-16-28"><a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">handleRequest</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
</span><span id="__span-16-29"><a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a><span class="w">      </span><span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span><span class="w"> </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;received&#39;</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-16-30"><a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-16-31"><a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a>
</span><span id="__span-16-32"><a id="__codelineno-16-32" name="__codelineno-16-32" href="#__codelineno-16-32"></a><span class="w">    </span><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">port</span><span class="p">);</span>
</span><span id="__span-16-33"><a id="__codelineno-16-33" name="__codelineno-16-33" href="#__codelineno-16-33"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-16-34"><a id="__codelineno-16-34" name="__codelineno-16-34" href="#__codelineno-16-34"></a><span class="p">}</span>
</span></code></pre></div>
<hr />
<h2 id="5-security-model-permissions-auditing-and-isolation">5. Security Model: Permissions, Auditing, and Isolation<a class="headerlink" href="#5-security-model-permissions-auditing-and-isolation" title="Permanent link">&para;</a></h2>
<h3 id="51-permission-system-architecture">5.1 Permission System Architecture<a class="headerlink" href="#51-permission-system-architecture" title="Permanent link">&para;</a></h3>
<h4 id="capability-based-access-control">Capability-Based Access Control<a class="headerlink" href="#capability-based-access-control" title="Permanent link">&para;</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="p">{</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="w">  </span><span class="nt">&quot;permissionModel&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">    </span><span class="nt">&quot;principle&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Capability-based security&quot;</span><span class="p">,</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">    </span><span class="nt">&quot;implementation&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">      </span><span class="nt">&quot;explicit_grant&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Permissions must be explicitly granted&quot;</span><span class="p">,</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">      </span><span class="nt">&quot;scope_limited&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Operations limited to defined boundaries&quot;</span><span class="p">,</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">      </span><span class="nt">&quot;revocable&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Permissions can be revoked at any time&quot;</span><span class="p">,</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">      </span><span class="nt">&quot;auditable&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;All permission decisions are logged&quot;</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="permission-categories">Permission Categories<a class="headerlink" href="#permission-categories" title="Permanent link">&para;</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="p">{</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">  </span><span class="nt">&quot;permissions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">    </span><span class="nt">&quot;tools&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">      </span><span class="nt">&quot;low_risk&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;read_file&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;list_directory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;search_files&quot;</span><span class="p">],</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">      </span><span class="nt">&quot;medium_risk&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;write_file&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;edit_file&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;git_commit&quot;</span><span class="p">],</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">      </span><span class="nt">&quot;high_risk&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;shell_execute&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;database_write&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;delete_file&quot;</span><span class="p">],</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">      </span><span class="nt">&quot;critical&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;system_modify&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;network_access&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;credential_access&quot;</span><span class="p">]</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">    </span><span class="nt">&quot;resources&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="w">      </span><span class="nt">&quot;read_only&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;file://&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;http://&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;https://&quot;</span><span class="p">],</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="w">      </span><span class="nt">&quot;read_write&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;file://workspace/&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;file://temp/&quot;</span><span class="p">],</span>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="w">      </span><span class="nt">&quot;protected&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;system://&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;credential://&quot;</span><span class="p">]</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="52-human-in-the-loop-approval-system">5.2 Human-in-the-Loop Approval System<a class="headerlink" href="#52-human-in-the-loop-approval-system" title="Permanent link">&para;</a></h3>
<h4 id="approval-workflow-matrix">Approval Workflow Matrix<a class="headerlink" href="#approval-workflow-matrix" title="Permanent link">&para;</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="p">{</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">  </span><span class="nt">&quot;approvalMatrix&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">    </span><span class="nt">&quot;filesystem&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">      </span><span class="nt">&quot;read_operations&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;auto_approve&quot;</span><span class="p">,</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">      </span><span class="nt">&quot;write_safe_paths&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;remember_preference&quot;</span><span class="p">,</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">      </span><span class="nt">&quot;write_system_paths&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;always_confirm&quot;</span><span class="p">,</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">      </span><span class="nt">&quot;delete_operations&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;require_explicit_approval&quot;</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="w">    </span><span class="nt">&quot;shell&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="w">      </span><span class="nt">&quot;read_only_commands&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;auto_approve&quot;</span><span class="p">,</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="w">      </span><span class="nt">&quot;build_commands&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;remember_preference&quot;</span><span class="p">,</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="w">      </span><span class="nt">&quot;install_commands&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;always_confirm&quot;</span><span class="p">,</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="w">      </span><span class="nt">&quot;system_commands&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;blocked&quot;</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="w">    </span><span class="nt">&quot;database&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="w">      </span><span class="nt">&quot;read_queries&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;auto_approve&quot;</span><span class="p">,</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="w">      </span><span class="nt">&quot;write_queries&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;always_confirm&quot;</span><span class="p">,</span>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="w">      </span><span class="nt">&quot;schema_changes&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;require_explicit_approval&quot;</span><span class="p">,</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a><span class="w">      </span><span class="nt">&quot;admin_operations&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;blocked&quot;</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="approval-state-management">Approval State Management<a class="headerlink" href="#approval-state-management" title="Permanent link">&para;</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1"># Approval state persistence</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">ApprovalManager</span><span class="p">:</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">storage_path</span> <span class="o">=</span> <span class="n">storage_path</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">approved_operations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_approvals</span><span class="p">()</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">check_approval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operation</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ApprovalResult</span><span class="p">:</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>        <span class="n">cache_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_cache_key</span><span class="p">(</span><span class="n">operation</span><span class="p">)</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>        <span class="n">cached_approval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">approved_operations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>        <span class="k">if</span> <span class="n">cached_approval</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">cached_approval</span><span class="o">.</span><span class="n">expired</span><span class="p">:</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>            <span class="k">return</span> <span class="n">ApprovalResult</span><span class="p">(</span><span class="n">cached_approval</span><span class="o">.</span><span class="n">decision</span><span class="p">,</span> <span class="n">cached_approval</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>        <span class="c1"># Request human approval</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>        <span class="n">decision</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_approval</span><span class="p">(</span><span class="n">operation</span><span class="p">)</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">store_approval</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="n">decision</span><span class="p">)</span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a>        <span class="k">return</span> <span class="n">ApprovalResult</span><span class="p">(</span><span class="n">decision</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
</span></code></pre></div>
<h3 id="53-auditing-and-logging">5.3 Auditing and Logging<a class="headerlink" href="#53-auditing-and-logging" title="Permanent link">&para;</a></h3>
<h4 id="comprehensive-audit-trail">Comprehensive Audit Trail<a class="headerlink" href="#comprehensive-audit-trail" title="Permanent link">&para;</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="p">{</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="w">  </span><span class="nt">&quot;auditEvent&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="w">    </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-11-25T10:30:00Z&quot;</span><span class="p">,</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">    </span><span class="nt">&quot;sessionId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sess_abc123&quot;</span><span class="p">,</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">    </span><span class="nt">&quot;userId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user_456&quot;</span><span class="p">,</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="w">    </span><span class="nt">&quot;operation&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="w">      </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tools/call&quot;</span><span class="p">,</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="w">      </span><span class="nt">&quot;tool&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;write_file&quot;</span><span class="p">,</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="w">      </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="w">        </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;~/projects/test.txt&quot;</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="w">    </span><span class="nt">&quot;security&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="w">      </span><span class="nt">&quot;permission&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;medium_risk&quot;</span><span class="p">,</span>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="w">      </span><span class="nt">&quot;approvalRequired&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="w">      </span><span class="nt">&quot;approvalGranted&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a><span class="w">      </span><span class="nt">&quot;approvalTimestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-11-25T10:30:15Z&quot;</span>
</span><span id="__span-21-18"><a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-21-19"><a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a><span class="w">    </span><span class="nt">&quot;outcome&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-20"><a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a><span class="w">      </span><span class="nt">&quot;success&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-21-21"><a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a><span class="w">      </span><span class="nt">&quot;duration&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;250ms&quot;</span><span class="p">,</span>
</span><span id="__span-21-22"><a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a><span class="w">      </span><span class="nt">&quot;resourceImpact&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;file_written&quot;</span>
</span><span id="__span-21-23"><a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-24"><a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-21-25"><a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="log-analysis-and-monitoring">Log Analysis and Monitoring<a class="headerlink" href="#log-analysis-and-monitoring" title="Permanent link">&para;</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1"># Security monitoring implementation</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">SecurityMonitor</span><span class="p">:</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alert_thresholds</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alert_thresholds</span> <span class="o">=</span> <span class="n">alert_thresholds</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">anomaly_detector</span> <span class="o">=</span> <span class="n">AnomalyDetector</span><span class="p">()</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">analyze_audit_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">events</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AuditEvent</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Alert</span><span class="p">]:</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>        <span class="n">anomalies</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">anomaly_detector</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>        <span class="n">alerts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>        <span class="k">for</span> <span class="n">anomaly</span> <span class="ow">in</span> <span class="n">anomalies</span><span class="p">:</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>            <span class="k">if</span> <span class="n">anomaly</span><span class="o">.</span><span class="n">risk_score</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">alert_thresholds</span><span class="p">[</span><span class="s1">&#39;critical&#39;</span><span class="p">]:</span>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>                <span class="n">alerts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Alert</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">anomaly</span><span class="p">))</span>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>            <span class="k">elif</span> <span class="n">anomaly</span><span class="o">.</span><span class="n">risk_score</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">alert_thresholds</span><span class="p">[</span><span class="s1">&#39;warning&#39;</span><span class="p">]:</span>
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>                <span class="n">alerts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Alert</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">anomaly</span><span class="p">))</span>
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a>
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a>        <span class="k">return</span> <span class="n">alerts</span>
</span></code></pre></div>
<hr />
<h2 id="6-advanced-protocol-features">6. Advanced Protocol Features<a class="headerlink" href="#6-advanced-protocol-features" title="Permanent link">&para;</a></h2>
<h3 id="61-streaming-and-chunked-responses">6.1 Streaming and Chunked Responses<a class="headerlink" href="#61-streaming-and-chunked-responses" title="Permanent link">&para;</a></h3>
<h4 id="large-response-handling">Large Response Handling<a class="headerlink" href="#large-response-handling" title="Permanent link">&para;</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="p">{</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="w">  </span><span class="nt">&quot;streamingResponse&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">    </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;responses/create&quot;</span><span class="p">,</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">    </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">      </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;resp_123&quot;</span><span class="p">,</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">      </span><span class="nt">&quot;model&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;claude-3-5-sonnet&quot;</span><span class="p">,</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">      </span><span class="nt">&quot;maxTokens&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">8192</span><span class="p">,</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">      </span><span class="nt">&quot;stream&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="w">  </span><span class="nt">&quot;streamingChunk&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="w">    </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;notifications/resource/updated&quot;</span><span class="p">,</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="w">    </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="w">      </span><span class="nt">&quot;uri&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;response://resp_123&quot;</span><span class="p">,</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="w">      </span><span class="nt">&quot;chunk&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;First part of a large response...&quot;</span>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="62-resource-subscriptions">6.2 Resource Subscriptions<a class="headerlink" href="#62-resource-subscriptions" title="Permanent link">&para;</a></h3>
<h4 id="change-notification-system">Change Notification System<a class="headerlink" href="#change-notification-system" title="Permanent link">&para;</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="p">{</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="w">  </span><span class="nt">&quot;subscription&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="w">    </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;resources/subscribe&quot;</span><span class="p">,</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="w">    </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="w">      </span><span class="nt">&quot;uri&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;file:///workspace/project.json&quot;</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="w">  </span><span class="nt">&quot;notification&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="w">    </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;notifications/resource/updated&quot;</span><span class="p">,</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="w">    </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="w">      </span><span class="nt">&quot;uri&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;file:///workspace/project.json&quot;</span><span class="p">,</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="w">      </span><span class="nt">&quot;change&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;content_modified&quot;</span>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="63-tool-composition-and-pipelining">6.3 Tool Composition and Pipelining<a class="headerlink" href="#63-tool-composition-and-pipelining" title="Permanent link">&para;</a></h3>
<h4 id="multi-tool-workflows">Multi-Tool Workflows<a class="headerlink" href="#multi-tool-workflows" title="Permanent link">&para;</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="p">{</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="w">  </span><span class="nt">&quot;toolPipeline&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">    </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tools/call&quot;</span><span class="p">,</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="w">    </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;execute_workflow&quot;</span><span class="p">,</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="w">      </span><span class="nt">&quot;arguments&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="w">        </span><span class="nt">&quot;workflow&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="w">            </span><span class="nt">&quot;tool&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;git_status&quot;</span><span class="p">,</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="w">            </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="w">            </span><span class="nt">&quot;tool&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;read_file&quot;</span><span class="p">,</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="w">            </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="w">              </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;package.json&quot;</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="w">            </span><span class="nt">&quot;condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;git_status.has_changes&quot;</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a><span class="w">            </span><span class="nt">&quot;tool&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;npm_install&quot;</span><span class="p">,</span>
</span><span id="__span-25-21"><a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a><span class="w">            </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-25-22"><a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a><span class="w">            </span><span class="nt">&quot;condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;package.json.modified&quot;</span>
</span><span id="__span-25-23"><a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-25-24"><a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-25-25"><a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-25-26"><a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-25-27"><a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-25-28"><a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a><span class="p">}</span>
</span></code></pre></div>
<hr />
<h2 id="7-error-handling-and-recovery">7. Error Handling and Recovery<a class="headerlink" href="#7-error-handling-and-recovery" title="Permanent link">&para;</a></h2>
<h3 id="71-standardized-error-codes">7.1 Standardized Error Codes<a class="headerlink" href="#71-standardized-error-codes" title="Permanent link">&para;</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="p">{</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">  </span><span class="nt">&quot;errorCodes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">    </span><span class="nt">&quot;-32700&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Parse error - Invalid JSON&quot;</span><span class="p">,</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="w">    </span><span class="nt">&quot;-32600&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Invalid Request - JSON-RPC formatting issue&quot;</span><span class="p">,</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="w">    </span><span class="nt">&quot;-32601&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Method not found&quot;</span><span class="p">,</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="w">    </span><span class="nt">&quot;-32602&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Invalid params&quot;</span><span class="p">,</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="w">    </span><span class="nt">&quot;-32603&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Internal error&quot;</span><span class="p">,</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="w">    </span><span class="nt">&quot;-32000&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Server error - Generic server error&quot;</span><span class="p">,</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="w">    </span><span class="nt">&quot;-32001&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Permission denied - Human approval required&quot;</span><span class="p">,</span>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="w">    </span><span class="nt">&quot;-32002&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Resource not found&quot;</span><span class="p">,</span>
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a><span class="w">    </span><span class="nt">&quot;-32003&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Rate limit exceeded&quot;</span><span class="p">,</span>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a><span class="w">    </span><span class="nt">&quot;-32004&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Connection timeout&quot;</span>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="72-recovery-strategies">7.2 Recovery Strategies<a class="headerlink" href="#72-recovery-strategies" title="Permanent link">&para;</a></h3>
<h4 id="connection-resilience">Connection Resilience<a class="headerlink" href="#connection-resilience" title="Permanent link">&para;</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="c1"># Robust connection handling</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">ResilientConnection</span><span class="p">:</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_with_retry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span><span class="p">):</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>                <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>            <span class="k">except</span> <span class="ne">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>                <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="n">max_retries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>                    <span class="k">raise</span>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>                <span class="n">wait_time</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">attempt</span>  <span class="c1"># Exponential backoff</span>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">wait_time</span><span class="p">)</span>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">reconnect</span><span class="p">()</span>
</span></code></pre></div>
<h4 id="graceful-degradation">Graceful Degradation<a class="headerlink" href="#graceful-degradation" title="Permanent link">&para;</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1"># Fallback capability negotiation</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">CapabilityNegotiator</span><span class="p">:</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">negotiate_capabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_capabilities</span><span class="p">,</span> <span class="n">server_capabilities</span><span class="p">):</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>        <span class="c1"># Find intersection of capabilities</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>        <span class="n">supported_capabilities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_intersection</span><span class="p">(</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>            <span class="n">client_capabilities</span><span class="p">,</span> 
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>            <span class="n">server_capabilities</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a>        <span class="p">)</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">supported_capabilities</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_capabilities</span><span class="p">:</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a>            <span class="c1"># Enable fallback modes</span>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_fallback_mode</span><span class="p">(</span><span class="n">supported_capabilities</span><span class="p">)</span>
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a>
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a>        <span class="k">return</span> <span class="n">supported_capabilities</span>
</span></code></pre></div>
<hr />
<h2 id="8-performance-optimization">8. Performance Optimization<a class="headerlink" href="#8-performance-optimization" title="Permanent link">&para;</a></h2>
<h3 id="81-message-compression-and-optimization">8.1 Message Compression and Optimization<a class="headerlink" href="#81-message-compression-and-optimization" title="Permanent link">&para;</a></h3>
<h4 id="efficient-message-formats">Efficient Message Formats<a class="headerlink" href="#efficient-message-formats" title="Permanent link">&para;</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="p">{</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="w">  </span><span class="nt">&quot;optimizationStrategies&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="w">    </span><span class="nt">&quot;compression&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="w">      </span><span class="nt">&quot;gzip&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Enable for all responses &gt; 1KB&quot;</span><span class="p">,</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="w">      </span><span class="nt">&quot;brotli&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Use for static resources when available&quot;</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="w">    </span><span class="nt">&quot;responseFiltering&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="w">      </span><span class="nt">&quot;selectiveFields&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Return only requested fields&quot;</span><span class="p">,</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="w">      </span><span class="nt">&quot;pagination&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Limit response sizes for large datasets&quot;</span><span class="p">,</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="w">      </span><span class="nt">&quot;summaries&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Provide summarized views for large content&quot;</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="w">    </span><span class="nt">&quot;caching&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="w">      </span><span class="nt">&quot;responseCache&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Cache frequently accessed resources&quot;</span><span class="p">,</span>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="w">      </span><span class="nt">&quot;metadataCache&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Cache server metadata and capabilities&quot;</span><span class="p">,</span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a><span class="w">      </span><span class="nt">&quot;permissionCache&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Cache approval decisions&quot;</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="82-concurrent-operations">8.2 Concurrent Operations<a class="headerlink" href="#82-concurrent-operations" title="Permanent link">&para;</a></h3>
<h4 id="parallel-tool-execution">Parallel Tool Execution<a class="headerlink" href="#parallel-tool-execution" title="Permanent link">&para;</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="c1"># Concurrent operation management</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">ConcurrentExecutor</span><span class="p">:</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_parallel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tools</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ToolCall</span><span class="p">]):</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute multiple tools simultaneously when possible&quot;&quot;&quot;</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>        <span class="c1"># Group independent tools</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>        <span class="n">independent_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_independent_tools</span><span class="p">(</span><span class="n">tools</span><span class="p">)</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">independent_groups</span><span class="p">:</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a>            <span class="c1"># Execute tools in parallel within each group</span>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a>            <span class="n">group_results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="p">[</span>
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">execute_single</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span> <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">group</span>
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a>            <span class="p">])</span>
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a>            <span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">group_results</span><span class="p">)</span>
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a>
</span><span id="__span-30-17"><a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a>        <span class="k">return</span> <span class="n">results</span>
</span></code></pre></div>
<hr />
<h2 id="9-protocol-extensions-and-customization">9. Protocol Extensions and Customization<a class="headerlink" href="#9-protocol-extensions-and-customization" title="Permanent link">&para;</a></h2>
<h3 id="91-custom-tool-categories">9.1 Custom Tool Categories<a class="headerlink" href="#91-custom-tool-categories" title="Permanent link">&para;</a></h3>
<h4 id="extending-the-protocol">Extending the Protocol<a class="headerlink" href="#extending-the-protocol" title="Permanent link">&para;</a></h4>
<div class="language-json highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="p">{</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="w">  </span><span class="nt">&quot;customCapabilities&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="w">    </span><span class="nt">&quot;mcp-extension&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="w">      </span><span class="nt">&quot;namespace&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;company.internal&quot;</span><span class="p">,</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="w">      </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="w">      </span><span class="nt">&quot;methods&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="w">        </span><span class="nt">&quot;custom/workflow_execute&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="w">          </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Execute company-specific workflow&quot;</span><span class="p">,</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="w">          </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="w">            </span><span class="nt">&quot;workflowId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a><span class="w">            </span><span class="nt">&quot;context&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-31-15"><a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-31-16"><a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-31-17"><a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="92-cross-protocol-compatibility">9.2 Cross-Protocol Compatibility<a class="headerlink" href="#92-cross-protocol-compatibility" title="Permanent link">&para;</a></h3>
<h4 id="adapter-pattern-implementation">Adapter Pattern Implementation<a class="headerlink" href="#adapter-pattern-implementation" title="Permanent link">&para;</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="c1"># Protocol adapter for legacy systems</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">ProtocolAdapter</span><span class="p">:</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">legacy_client</span><span class="p">):</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">legacy_client</span> <span class="o">=</span> <span class="n">legacy_client</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">translate_to_mcp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">legacy_request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MCPRequest</span><span class="p">:</span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Translate legacy protocol to MCP format&quot;&quot;&quot;</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>        <span class="k">return</span> <span class="n">MCPRequest</span><span class="p">(</span>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>            <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">translate_method</span><span class="p">(</span><span class="n">legacy_request</span><span class="o">.</span><span class="n">method</span><span class="p">),</span>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a>            <span class="n">params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">translate_params</span><span class="p">(</span><span class="n">legacy_request</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>        <span class="p">)</span>
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a>
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">translate_from_mcp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mcp_response</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LegacyResponse</span><span class="p">:</span>
</span><span id="__span-32-14"><a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Translate MCP response to legacy format&quot;&quot;&quot;</span>
</span><span id="__span-32-15"><a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a>        <span class="k">return</span> <span class="n">LegacyResponse</span><span class="p">(</span>
</span><span id="__span-32-16"><a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a>            <span class="n">data</span><span class="o">=</span><span class="n">mcp_response</span><span class="o">.</span><span class="n">result</span><span class="p">,</span>
</span><span id="__span-32-17"><a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a>            <span class="n">status</span><span class="o">=</span><span class="s2">&quot;success&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">mcp_response</span><span class="o">.</span><span class="n">error</span> <span class="k">else</span> <span class="s2">&quot;error&quot;</span>
</span><span id="__span-32-18"><a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a>        <span class="p">)</span>
</span></code></pre></div>
<hr />
<h2 id="10-best-practices-and-implementation-guidelines">10. Best Practices and Implementation Guidelines<a class="headerlink" href="#10-best-practices-and-implementation-guidelines" title="Permanent link">&para;</a></h2>
<h3 id="101-server-development-guidelines">10.1 Server Development Guidelines<a class="headerlink" href="#101-server-development-guidelines" title="Permanent link">&para;</a></h3>
<h4 id="security-implementation-checklist">Security Implementation Checklist<a class="headerlink" href="#security-implementation-checklist" title="Permanent link">&para;</a></h4>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Implement capability-based permission checks</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Add input validation and sanitization</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Include comprehensive audit logging</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Support human-in-the-loop approval workflows</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Use sandboxing for resource-intensive operations</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Implement proper error handling without exposing sensitive data</li>
</ul>
<h4 id="performance-guidelines">Performance Guidelines<a class="headerlink" href="#performance-guidelines" title="Permanent link">&para;</a></h4>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Use streaming responses for large datasets</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Implement intelligent caching strategies</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Support concurrent operations where appropriate</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Optimize message sizes through selective field return</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Monitor and limit resource usage per client</li>
</ul>
<h3 id="102-client-implementation-guidelines">10.2 Client Implementation Guidelines<a class="headerlink" href="#102-client-implementation-guidelines" title="Permanent link">&para;</a></h3>
<h4 id="robust-error-handling">Robust Error Handling<a class="headerlink" href="#robust-error-handling" title="Permanent link">&para;</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="c1"># Comprehensive error handling</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">MCPClient</span><span class="p">:</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">send_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>        <span class="k">except</span> <span class="n">NetworkError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_network_error</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>        <span class="k">except</span> <span class="n">ProtocolError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_protocol_error</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>        <span class="k">except</span> <span class="ne">PermissionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_permission_error</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a>            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span></code></pre></div>
<hr />
<h2 id="11-testing-and-validation">11. Testing and Validation<a class="headerlink" href="#11-testing-and-validation" title="Permanent link">&para;</a></h2>
<h3 id="111-protocol-compliance-testing">11.1 Protocol Compliance Testing<a class="headerlink" href="#111-protocol-compliance-testing" title="Permanent link">&para;</a></h3>
<h4 id="automated-test-suite">Automated Test Suite<a class="headerlink" href="#automated-test-suite" title="Permanent link">&para;</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1"># MCP Protocol compliance tests</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">MCPProtocolTests</span><span class="p">:</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_json_rpc_format</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ensure all messages follow JSON-RPC 2.0 specification&quot;&quot;&quot;</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>        <span class="c1"># Test message format compliance</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>        <span class="k">pass</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_capability_negotiation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Verify proper capability negotiation&quot;&quot;&quot;</span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a>        <span class="c1"># Test initialization and capability exchange</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a>        <span class="k">pass</span>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_security_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate security controls are properly implemented&quot;&quot;&quot;</span>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a>        <span class="c1"># Test permission enforcement and approval workflows</span>
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a>        <span class="k">pass</span>
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a>
</span><span id="__span-34-18"><a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_error_handling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-34-19"><a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test error scenarios and recovery&quot;&quot;&quot;</span>
</span><span id="__span-34-20"><a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a>        <span class="c1"># Test various error conditions and handling</span>
</span><span id="__span-34-21"><a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a>        <span class="k">pass</span>
</span></code></pre></div>
<hr />
<h2 id="12-conclusion">12. Conclusion<a class="headerlink" href="#12-conclusion" title="Permanent link">&para;</a></h2>
<p>The Model Context Protocol architecture provides a robust, secure, and scalable foundation for AI-tool integration. Key architectural insights include:</p>
<h3 id="design-strengths">Design Strengths<a class="headerlink" href="#design-strengths" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Clear Separation of Concerns</strong>: Client-Host-Server topology enables flexible deployment patterns</li>
<li><strong>Transport Agnostic</strong>: Protocol works equally well over stdio, SSE, and HTTP transports</li>
<li><strong>Security First</strong>: Capability-based permissions with human-in-the-loop approval</li>
<li><strong>Performance Optimized</strong>: Streaming, caching, and concurrent operation support</li>
</ol>
<h3 id="implementation-considerations">Implementation Considerations<a class="headerlink" href="#implementation-considerations" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Security is Paramount</strong>: Proper permission implementation is non-negotiable</li>
<li><strong>Performance Matters</strong>: Efficient message handling determines user experience</li>
<li><strong>Compatibility is Key</strong>: Protocol extensions should maintain backward compatibility</li>
<li><strong>Monitoring is Essential</strong>: Audit trails enable security analysis and debugging</li>
</ol>
<p>The MCP architecture has proven itself in production environments from individual developers to enterprise deployments. Understanding these architectural principles is essential for building robust MCP servers and clients that can scale from personal projects to enterprise systems.</p>
<hr />
<p><em>Next: Chapter 3 provides practical guidance for getting started with MCP setup and configuration.</em></p>














                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://zensical.org/" target="_blank" rel="noopener">
      Zensical
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      
      <script id="__config" type="application/json">{"annotate":null,"base":"../..","features":[],"search":"../../assets/javascripts/workers/search.5df7522c.min.js","tags":null,"translations":{"clipboard.copied":"Copied to clipboard","clipboard.copy":"Copy to clipboard","search.result.more.one":"1 more on this page","search.result.more.other":"# more on this page","search.result.none":"No matching documents","search.result.one":"1 matching document","search.result.other":"# matching documents","search.result.placeholder":"Type to start searching","search.result.term.missing":"Missing","select.version":"Select version"},"version":null}</script>
    
    
      <script src="../../assets/javascripts/bundle.21aa498e.min.js"></script>
      
    
  </body>
</html>